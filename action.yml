name: 'Install Vulkan SDK'
description: 'Installs the Vulkan SDK and sets the VULKAN_SDK environment variable'
inputs:
  vulkan-version:
    description: 'specify a Vulkan SDK release version, e.g. 1.2.162.1'
    default: 'latest'
    required: false
  vulkan-version-linux:
    description: 'specify a linux-specific Vulkan SDK release version, e.g. 1.2.162.1'
    default: ''
    required: false
  vulkan-version-windows:
    description: 'specify a windows-specific Vulkan SDK release version, e.g. 1.2.162.1'
    default: ''
    required: false
runs:
  using: "composite"
  steps: 

    - name: Determine requested SDK Version
      shell: bash
      run: |
        case `uname -s` in
          Linux)
            echo VK_VERSION=${{ inputs.vulkan-version-linux }} >> $GITHUB_ENV
            ;;
          Darwin)
            ;;
          *) # Windows
            echo VK_VERSION=${{ inputs.vulkan-version-windows }} >> $GITHUB_ENV
            ;;
        esac

    - name: Download and extract Vulkan SDK
      shell: bash
      run: |
        VK_VERSION=${VK_VERSION:-${{ inputs.vulkan-version }}}
        echo "VK_VERSION=VK_VERSION" >> $GITHUB_ENV
        echo "requested SDK version is $VK_VERSION" >&2
        ${{ github.action_path }}/install_vulkan_sdk.sh $VK_VERSION | tee -a $GITHUB_ENV

    - name: Verify Vulkan SDK installation
      shell: bash
      run: |
        if [ -z "$VULKAN_SDK" ]; then
          echo "Failed to install Vulkan SDK ${{ inputs.vulkan-version }} using '$VULKAN_SDK_URL'."
          exit 3
        else
          echo "Vulkan SDK ${{ inputs.vulkan-version }} ($VULKAN_SDK_VERSION) successfully installed using '$VULKAN_SDK_URL'."
        fi
